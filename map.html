<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="leaflet/leaflet.css">
    <script src="leaflet/leaflet.js"></script>
    <script src="papaparse.min.js"></script>
    <script src="markers.js"></script>
    <style>
      body {
          padding: 0;
          margin: 0;
      }
      html, body, #image-map {
          height: 100%;
          width: 100%;
          z-index: 1;
      }

      .leaflet-container {
        background: white;
      }

      #fullscreen_btn {
        position: absolute;
        right: 20px;
        bottom: 30px;
        z-index: 2;
        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div id="image-map"></div>
    <div id="fullscreen_btn"><input type="button" value="Plein écran" onclick="toggleFullScreen()"></div>

    <script>
      // Loading data from CSV for markers
      csv="data/markers.csv";
      Papa.parse(csv, {
  	       download: true,
           encoding: "UTF-8",
           header: true,
  	       dynamicTyping: true,
           skipEmptyLines: true,
           complete: function(results) {
  		         addMarkers(results.data);
  	       }
       });

       // Custom icons
       var blueIcon = L.icon({
         iconUrl:       'leaflet/images/marker-icon.png',
         iconRetinaUrl: 'leaflet/images/marker-icon-2x.png',
         shadowUrl:     'leaflet/images/marker-shadow.png',
         iconSize:    [25, 41],
         iconAnchor:  [12, 41],
         popupAnchor: [1, -34],
         tooltipAnchor: [16, -28],
         shadowSize:  [41, 41]
       });

       var redIcon = L.icon({
         iconUrl:       'leaflet/images/marker-icon_red.png',
         iconRetinaUrl: 'leaflet/images/marker-icon-2x-red.png',
         shadowUrl:     'leaflet/images/marker-shadow.png',
         iconSize:    [25, 41],
         iconAnchor:  [12, 41],
         popupAnchor: [1, -34],
         tooltipAnchor: [16, -28],
         shadowSize:  [41, 41]
       });


       // Predefined marker types
       var types = [
         {
           name: "Aménagements",
           icon: blueIcon
         },
         {
           name: "Plantes",
           icon: redIcon
         },
         {
           name: "Arbres",
           icon: redIcon
         }
       ]


      // Using leaflet.js with a simple image
      // Tutorial : http://leafletjs.com/examples/crs-simple/crs-simple.html
      var map = L.map('image-map', {
        minZoom: -2,
        crs: L.CRS.Simple
      });
      /* dimensions of the image
          width = 4961
          height = 3508
          url = 'images/fond.jpg'
      */
      var bounds = [[0,0], [3508,4961]];
      var image = L.imageOverlay('images/fond.jpg', bounds).addTo(map);
      map.fitBounds(bounds);



      // Adding markers to leaflet map
      function addMarkers(data) {
        var overlayMaps = {}; // will contain layers of markers

        for ( var i in types ){
          var markers = [];

          markers = data.filter(l => l.type == types[i].name).map(customMarker => { // Javascript array.map()
            return L.marker(customMarker, {icon: types[i].icon}).bindPopup(customMarker.popup, { minWidth: 200})
          });

          var LayerGroup = L.layerGroup(markers);


          overlayMaps[ types[i].name ] = LayerGroup.addTo(map);
        };

        L.control.layers(null, overlayMaps, {collapsed: false}).addTo(map);

      };

      // A way to get leaflet coordinates with right click
      map.on('contextmenu', function(e) {
          alert("Lat, Lon : " + e.latlng.lat + ", " + e.latlng.lng)
      });

      // Toggle fullscreen
      function toggleFullScreen() {
        if ((document.fullScreenElement && document.fullScreenElement !== null) ||
         (!document.mozFullScreen && !document.webkitIsFullScreen)) {
          if (document.documentElement.requestFullScreen) {
            document.documentElement.requestFullScreen();
          } else if (document.documentElement.mozRequestFullScreen) {
            document.documentElement.mozRequestFullScreen();
          } else if (document.documentElement.webkitRequestFullScreen) {
            document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
          }
        } else {
          if (document.cancelFullScreen) {
            document.cancelFullScreen();
          } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
          } else if (document.webkitCancelFullScreen) {
            document.webkitCancelFullScreen();
          }
        }
      }
    </script>

  </body>
</html>
